/*! grudus-timepicker | (c) 2017-2019 
    grudus | Apache-2.0 license (see LICENSE) */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Timepicker=t()}(this,function(){"use strict";var i=/^([0-1]?[0-9]|2[0-3])$/,o=/^([0-5]?[0-9])$/,n=/^([0-1]?[0-9]|2[0-3]):([0-5][0-9])$/;function s(e,t){if(e){if(i.test(e.hours)&&o.test(e.minutes)&&void 0!==e.meridiem&&0<e.meridiem.length)return{hours:parseInt(e.hours),minutes:parseInt(e.minutes),meridiem:e.meridiem};if(i.test(e.hours)&&o.test(e.minutes))return{hours:parseInt(e.hours),minutes:parseInt(e.minutes)};if(n.test(e))return function(e){var t=n.exec(e);return{hours:parseInt(t[1]),minutes:parseInt(t[2])}}(e);if(e instanceof Date)return c(e,t);throw new TypeError("INVALID FORMAT: {"+JSON.stringify(e)+"}.\n            Time must be a Date or 'hh:MM' string or object with 'hours' and 'minutes' fields")}return c(new Date,t)}function c(e,t){return void 0===t||t?function(e){var t="",i=e.getHours();t=i<13?"am":"pm";12!==i&&(i%=12);return{hours:i,minutes:e.getMinutes(),meridiem:t}}(e):{hours:e.getHours(),minutes:e.getMinutes()}}function l(e,t){var i=s(e,t);return(i.hours<10?"0"+i.hours:i.hours)+":"+(i.minutes<10?"0"+i.minutes:i.minutes)+" "+(void 0!==i.meridiem?i.meridiem:"")}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var u=function(e){var t=["<section class='g-time-wrapper'>","    <header class='g-head g-flex' id='g-head'>","        <section class='g-head-content'>","            <span class='g-current g-hour g-active g-pointer' id='g-hours'>21</span>","            <span class='g-current'>:</span>","            <span class='g-current g-minute g-pointer' id='g-minutes'>37</span>"];e.meridiem&&t.push(["<div class='content-meridiem'>","<span id='g-time-am' class='item-meridiem g-am g-pointer'>AM</span>","<span id='g-time-pm' class='item-meridiem g-pm g-pointer'>PM</span>","</div>"].join("\n"));var i=["        </section>","    </header>","","","    <section class='g-clock-wrapper g-flex' id='g-clock-wrapper'>","        <div class='g-clock' id='g-clock'>","            <span class='g-middle-dot' id='g-middle-dot'></span>","            <div class='g-hand-of-a-clock' id='g-hand-of-a-clock'></div>","            <div class='g-clock g-clock-inner' id='g-clock-inner'></div>","        </div>","    </section>","","","    <footer class='g-buttons g-flex' id='g-buttons'>"];return i.push("\n        <button id='g-time-cancel' class='g-button g-cancel g-pointer'>"+(e.labels.cancel||"")+"</button>\n        <button id='g-time-submit' class='g-button g-submit g-pointer'>"+(e.labels.ok||"")+"</button>\n    "),i.push("</footer> </section>"),t.concat(i).join("\n")},a={clock:"g-clock",clockItem:"g-clock-item",inner:"g-clock-inner",outer:"g-clock-outer",item:"g-clock-item",hand:"g-hand-of-a-clock",fadeOut:"g-fade-out",selected:"g-selected",active:"g-active",submit:"g-submit",cancel:"g-cancel",hour:"g-hour",minute:"g-minute"},d={headerId:"g-head",hoursId:"g-hours",minutesId:"g-minutes",clockId:"g-clock",innerId:"g-clock-inner",wrapperId:"g-clock-wrapper",dotId:"g-middle-dot",handId:"g-hand-of-a-clock",buttonsId:"g-buttons",submitId:"g-time-submit",cancelId:"g-time-cancel",gTimeAmId:"g-time-am",gTimePmId:"g-time-pm"},h={clockId:"grudus-clock",clockConfig:{onSubmit:function(){},onCancel:function(){},headerBackground:"#1976D2",headerColor:"#c7d6e1",headerSelected:"#ffffff",wrapperBackground:"#f0fff0",footerBackground:"#f0fff0",submitColor:"#1976D2",cancelColor:"#1976D2",clockBackground:"#CFD8DC",clockItemColor:"#212121",clockItemInnerColor:"#212121",handColor:"#1976D2",meridiem:!1,labels:{cancel:"Cancel",ok:"Ok"}},FaceType:{HOURS:"hours",MINUTES:"minutes"}},e=function(e,t,i){return t&&m(e.prototype,t),i&&m(e,i),e};function m(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var t=(e(f,[{key:"initView",value:function(){var e=this;this.headerHours=document.getElementById(d.hoursId),this.headerHours.onclick=function(){e.toggleActiveToHours(),e.onHourClicked()},this.headerMinutes=document.getElementById(d.minutesId),this.headerMinutes.onclick=function(){e.toggleActiveToMinutes(),e.onMinutesClicked()},this.options.meridiem&&(this.headerAm=document.getElementById(d.gTimeAmId),this.headerPm=document.getElementById(d.gTimePmId),this.headerAm.onclick=function(){e.toogleActiveMeridiemAm(),e.time.meridiem="am"},this.headerPm.onclick=function(){e.toogleActiveMeridiemPm(),e.time.meridiem="pm"},"am"===this.time.meridiem?this.toogleActiveMeridiemAm():"pm"===this.time.meridiem?this.toogleActiveMeridiemPm():this.defaultToggleActiveMeridiem()),this.updateDisplayedTime(),this.toggleActiveToHours()}},{key:"toggleActiveToMinutes",value:function(){this.toggleActive(this.headerHours,this.headerMinutes)}},{key:"toggleActiveToHours",value:function(){this.toggleActive(this.headerMinutes,this.headerHours)}},{key:"toogleActiveMeridiemAm",value:function(){this.toggleActive(this.headerPm,this.headerAm)}},{key:"toogleActiveMeridiemPm",value:function(){this.toggleActive(this.headerAm,this.headerPm)}},{key:"defaultToggleActiveMeridiem",value:function(){this.time.hours<13?this.toogleActiveMeridiemAm():this.toogleActiveMeridiemPm()}},{key:"toggleActive",value:function(e,t){e.style.color=this.options.headerColor,t.style.color=this.options.headerSelected}},{key:"updateDisplayedTime",value:function(){f.doUpdateDisplayedTime(this.headerHours,this.time.hours,this.options.meridiem),f.doUpdateDisplayedTime(this.headerMinutes,this.time.minutes)}}],[{key:"doUpdateDisplayedTime",value:function(e,t,i){i&&12!==t&&(t%=12),e.innerText=t<10?"0"+t:t}}]),f);function f(e){r(this,f),this.options=e.options,this.time=e.time,this.onHourClicked=e.onHourClicked,this.onMinutesClicked=e.onMinutesClicked,this.initView()}var k=(e(g,[{key:"onEnter",value:function(){this.selected=this.findSelected(this.minutes),this.colorSelected(),this.updateMinutes(this.minutes,6*this.minutes)}},{key:"onLeave",value:function(){this.selected&&(this.removeSelected(),this.selected=void 0)}},{key:"selectTime",value:function(e){this.selected&&this.removeSelected();var t=Math.round(e/6)%60;this.selected=this.findSelected(t),this.colorSelected(),this.minutes=t,this.updateMinutes(this.minutes,e)}},{key:"findSelected",value:function(e){return e%5==0?this.items.clockItems[e/5]:this.items.outerClockItems[e]}},{key:"colorSelected",value:function(){this.isOuter()?this.selected.classList.add(a.selected):(this.selected.style.background=this.options.handColor,this.selected.style.color="whitesmoke")}},{key:"removeSelected",value:function(){this.isOuter()?this.selected.classList.remove(a.selected):(this.selected.style.background="transparent",this.selected.style.color=this.options.clockItemColor)}},{key:"isOuter",value:function(){return-1<this.items.outerClockItems.indexOf(this.selected)}}]),g);function g(e,t,i){r(this,g),this.displayed=["00","05","10","15","20","25","30","35","40","45","50","55"],this.options=e.options,this.type=h.FaceType.MINUTES,this.selected=void 0,this.items=e,this.minutes=t,this.updateMinutes=i}var p=(e(v,[{key:"onEnter",value:function(){null!==this.items.innerClockElem&&(this.items.innerClockElem.style.display="block");var e=this.hours<13&&0!==this.hours,t=this.hours%12,i=this.items.radius;this.options.meridiem&&!e?this.selected=this.items.clockItems[t]:(this.selected=e?this.items.clockItems[t]:this.items.innerClockItems[t],i=e?i:i-50),this.colorSelected(),this.updateHours(this.hours,30*t,i)}},{key:"onLeave",value:function(){null!==this.items.innerClockElem&&(this.items.innerClockElem.style.display="none"),this.selected&&(this.removeSelected(),this.selected=void 0)}},{key:"selectTime",value:function(e,t){this.selected&&this.removeSelected();var i=Math.round(e/30)%12;this.selected=(t===this.items.innerClockElem&&void 0!==this.items.innerClockElem?this.items.innerClockItems:this.items.clockItems)[i],this.colorSelected(),this.hours=parseInt(this.selected.innerText);var o=30*Math.round(e/30);this.updateHours(this.hours,o,t===this.items.innerClockElem&&void 0!==this.items.innerClockElem?this.items.radius-50:this.items.radius)}},{key:"colorSelected",value:function(){this.selected.style.background=this.options.handColor,this.selected.style.color="#ffffff"}},{key:"removeSelected",value:function(){this.selected.style.background="transparent",this.selected.style.color=this.isInner()?this.options.clockItemInnerColor:this.options.clockItemColor}},{key:"isInner",value:function(){return-1<Array.from(this.items.innerClockItems).indexOf(this.selected)}}]),v);function v(e,t,i){r(this,v),this.displayed=["12","1","2","3","4","5","6","7","8","9","10","11"],this.displayedInner=["00","13","14","15","16","17","18","19","20","21","22","23"],this.type=h.FaceType.MINUTES,this.selected=void 0,this.options=e.options,this.items=e,this.hours=t,this.updateHours=i}Promise.delay=function(e,t){return t||(t=e,e=function(){}),function(t){return new Promise(function(e){setTimeout(e,t)})}(t).then(e)},Promise.prototype.delay=function(e,t){return this.then(function(){return Promise.delay(e,t)})};var y={toRadians:function(e){return e*(Math.PI/180)},toDegrees:function(e){return e*(180/Math.PI)},findMousePosition:function(e,t){var i=t.getBoundingClientRect();return{x:e.clientX-i.left,y:e.clientY-i.top}}},I=(e(C,[{key:"create",value:function(e,t,i,o){C.doCreate(e,this.clockElem,function(e){return e.classList.add(a.item)}),this.options.meridiem||C.doCreate(t,this.innerClockElem,function(e,t){e.classList.add(a.item,a.inner),e.innerText=o.displayedInner[t]});for(var n=0;n<60;n++){var s=document.createElement("span");s.classList.add(a.outer),i.push(s),this.clockElem.appendChild(s)}}},{key:"calculateSize",value:function(e,t,i){if(this.size.width=this.clockElem.offsetWidth,this.size.height=this.clockElem.offsetHeight,this.middle.x=this.size.width/2,this.middle.y=this.size.height/2,this.itemsRadius=this.size.width/2-20,C.doCalculateSize(this.middle.x,this.middle.y,this.itemsRadius,e),!this.options.meridiem){var o=this.innerClockElem.offsetWidth,n=this.innerClockElem.offsetHeight;C.doCalculateSize(o/2,n/2,this.itemsRadius-40,t)}C.doCalculateSize(this.middle.x,this.middle.y,this.itemsRadius,i)}}],[{key:"doCreate",value:function(e,t,i){for(var o=0;o<12;o++){var n=document.createElement("span");i(n,o),e.push(n),t.appendChild(n)}}},{key:"doCalculateSize",value:function(e,t,i,o){for(var n=360/o.length,s=0;s<o.length;s++){var c=y.toRadians(s*n),l=o[s],r=l.offsetWidth,u=l.offsetHeight;l.style.left=e+Math.sin(c)*i-r/2+"px",l.style.bottom=t+Math.cos(c)*i-u/2+"px"}}}]),C);function C(e,t,i){r(this,C),this.clockElem=e,this.innerClockElem=t,this.size={},this.middle={},this.options=i}var E=(e(T,[{key:"initViews",value:function(){var t=this;this.clockElem=document.getElementById(d.clockId),this.innerClockElem=this.options.meridiem?null:document.getElementById(d.innerId),this.handOfAClock=document.getElementById(d.handId),this.clockElem.onmousedown=function(){return t.isMouseDown=!0},this.clockElem.onmouseup=function(){t.isMouseDown=!1,t.toggleToMinutes()},this.handOfAClock.onmouseup=function(e){return e.stopPropagation()},this.handOfAClock.onmousemove=function(e){return e.stopPropagation()},this.handOfAClock.onclick=function(e){return e.stopPropagation()},this.clockElem.onmousemove=function(e){return t.selectTime(e,!1,t.clockElem)},this.clockElem.onclick=function(e){return t.selectTime(e,!0,t.clockElem)},this.options.meridiem||(this.innerClockElem.onmousemove=function(e){return t.selectTime(e,!1,t.innerClockElem)},this.innerClockElem.onclick=function(e){return t.selectTime(e,!0,t.innerClockElem)})}},{key:"initTimeFaces",value:function(e){var o=this;this.minutesFace=new k({options:this.options,clockItems:this.clockItems,outerClockItems:this.outerClockItems},e.minutes,function(e,t){return o.updateMinutes(e,t)}),this.hoursFace=new p({options:this.options,innerClockItems:this.innerClockItems,clockItems:this.clockItems,innerClockElem:this.innerClockElem},e.hours,function(e,t,i){return o.updateHours(e,t,i)})}},{key:"onStart",value:function(){this.currentFace.onEnter()}},{key:"createFace",value:function(){var e=new I(this.clockElem,this.innerClockElem,this.options);e.create(this.clockItems,this.innerClockItems,this.outerClockItems,this.hoursFace),e.calculateSize(this.clockItems,this.innerClockItems,this.outerClockItems),this.size=e.size,this.middle=e.middle,this.itemsRadius=e.itemsRadius}},{key:"selectTime",value:function(e,t,i){if(t||this.isMouseDown){var o=y.findMousePosition(e,this.clockElem),n=o.x-this.middle.x,s=this.middle.y-o.y,c=90-y.toDegrees(Math.atan(s/n));n<0&&(c+=180),this.currentFace.selectTime(c,i),e.stopPropagation()}}},{key:"changeDisplayed",value:function(e){for(var t=0;t<this.clockItems.length;t++)this.clockItems[t].innerText=e[t]}},{key:"onEachClockElement",value:function(t){[].forEach.call(this.clockItems,function(e){return t(e)})}},{key:"updateMinutes",value:function(e,t){this.time.minutes=e,this.calculateHandOfTheClock(t,this.itemsRadius),this.onTimeUpdate(this.time,h.FaceType.MINUTES)}},{key:"updateHours",value:function(e,t,i){this.time.hours=e,this.calculateHandOfTheClock(t,i),this.onTimeUpdate(this.time,h.FaceType.HOURS)}},{key:"calculateHandOfTheClock",value:function(e,t){var i=1<arguments.length&&void 0!==t?t:this.itemsRadius;this.handOfAClock.style.transform="rotate("+(e-90)+"deg)",this.handOfAClock.style.width=i+"px"}},{key:"toggleToHours",value:function(){this.minutesFace.onLeave(),this.toggleTime(this.hoursFace)}},{key:"toggleToMinutes",value:function(){this.hoursFace.onLeave(),this.toggleTime(this.minutesFace)}},{key:"toggleTime",value:function(e){var t=this;this.currentFace!==e&&(this.onEachClockElement(function(e){return e.classList.add(a.fadeOut)}),this.handOfAClock.classList.add(a.fadeOut),Promise.delay(function(){t.onEachClockElement(function(e){return e.classList.remove(a.fadeOut)}),t.handOfAClock.classList.remove(a.fadeOut),t.changeDisplayed(e.displayed),t.currentFace=e,t.onEachClockElement(function(e){return t.removeSelected(e)}),e.onEnter()},300))}},{key:"removeSelected",value:function(e){e.classList.remove(a.selected),e.style.background="transparent",e.style.color=this.options.clockItemColor}}]),T);function T(e,t,i){r(this,T),this.options=e,this.time=t,this.onTimeUpdate=i,this.isMouseDown=!1,this.clockItems=[],this.innerClockItems=[],this.outerClockItems=[],this.size={},this.middle={},this.initViews(),this.initTimeFaces(t),this.createFace(e),this.hoursFace.items.radius=this.itemsRadius,this.currentFace=this.hoursFace,this.changeDisplayed(this.currentFace.displayed)}var M=(e(b,[{key:"initView",value:function(){var t=this;this.submitButton=document.getElementById(d.submitId),this.submitButton.onclick=function(){var e=t.time;e.formatted=function(){return l(e,t.options.meridiem)},t.options.onSubmit(e),b.dispose()},this.cancelButton=document.getElementById(d.cancelId),this.cancelButton.onclick=function(){t.options.onCancel(),b.dispose()}}},{key:"initElements",value:function(){var i=this;this.header=new t({options:this.options,time:this.time,onHourClicked:function(){return i.toggleToHours()},onMinutesClicked:function(){return i.toggleToMinutes()}}),this.clockFace=new E(this.options,this.time,function(e,t){return i.onTimeUpdate(e,t)})}},{key:"onStart",value:function(){this.clockFace.onStart()}},{key:"toggleToHours",value:function(){this.clockFace.toggleToHours()}},{key:"toggleToMinutes",value:function(){this.clockFace.toggleToMinutes()}},{key:"onTimeUpdate",value:function(e,t){this.time=e,this.header.time=e,this.header.updateDisplayedTime(),t===h.FaceType.MINUTES&&this.header.toggleActiveToMinutes()}}],[{key:"dispose",value:function(){document.body.removeChild(document.getElementById(h.clockId))}}]),b);function b(e,t){r(this,b),this.options=e,this.initView(),this.time=t,this.initElements()}function A(e,t,i){var o=2<arguments.length&&void 0!==i?i:"color",n=Array.from(document.getElementsByClassName(e)),s=!0,c=!1,l=void 0;try{for(var r,u=n[Symbol.iterator]();!(s=(r=u.next()).done);s=!0){r.value.style[o]=t}}catch(e){c=!0,l=e}finally{try{!s&&u.return&&u.return()}finally{if(c)throw l}}}function w(e){var t=0<arguments.length&&void 0!==e?e:{},i=Object.assign({},h.clockConfig,t);!function(e){if(document.getElementById(h.clockId))throw Error("There is already one running grudus-timepicker instance!");var t=document.createElement("div");t.id=h.clockId,t.innerHTML=u(e),document.body.appendChild(t)}(i);var o=s(i.time,i.meridiem),n=new M(i,o);!function(e){document.getElementById(d.headerId).style.background=e.headerBackground,document.getElementById(d.headerId).style.color=e.headerColor,document.getElementById(d.wrapperId).style.background=e.wrapperBackground,document.getElementById(d.clockId).style.background=e.clockBackground,document.getElementById(d.handId).style.background=e.handColor,document.getElementById(d.dotId).style.background=e.handColor,document.getElementById(d.buttonsId).style.background=e.footerBackground,document.getElementById(d.submitId).style.color=e.submitColor,document.getElementById(d.cancelId).style.color=e.cancelColor,A(a.clockItem,e.clockItemColor),A(a.inner,e.clockItemInnerColor),A(a.outer,e.handColor,"borderColor")}(i),n.onStart()}return{showPicker:function(e){return w(e)},format:function(e){return l(e)}}});
//# sourceMappingURL=grudus-timepicker.es5.js.map
